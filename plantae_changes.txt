#read csv

#remove unneeded columns

#rename columns with uppercase letters

ALTER TABLE plantae RENAME COLUMN "decimalLatitude" TO latitude; 
ALTER TABLE plantae RENAME COLUMN "decimalLongitude" TO longitude; 
ALTER TABLE plantae RENAME COLUMN "coordinateUncertaintyInMeters" TO coordinate_uncertainty;
ALTER TABLE plantae RENAME COLUMN "taxonKey" TO taxon_key; 
ALTER TABLE plantae RENAME COLUMN "speciesKey" TO species_key; 
ALTER TABLE plantae RENAME COLUMN "basisOfRecord" TO basis_of_record; 

#remove rows with coordinate uncertainty larger than 10000m

SELECT DISTINCT coordinate_uncertainty FROM plantae;
SELECT COUNT(*) FROM plantae WHERE coordinate_uncertainty is NULL;
SELECT COUNT(*) FROM plantae WHERE coordinate_uncertainty > 10000;


#remove rows with year lower than 1920

SELECT DISTINCT year FROM plantae;
SELECT COUNT(*) FROM plantae WHERE year is NULL;
SELECT COUNT(*) FROM plantae WHERE year > 1920;
DELETE FROM plantae WHERE year < 1920;

#remove rows where latitude or taxonomy has NULL

DELETE FROM plantae WHERE latitude IS NULL OR longitude IS NULL OR species IS NULL;

#round latitude and longitude to three decimal places

UPDATE plantae SET latitude = ROUND(latitude::numeric, 3);
UPDATE plantae SET longitude = ROUND(longitude::numeric, 3);

#remove duplicates for species, latitude, and longitude

DELETE FROM plantae WHERE plantae.id NOT IN
(SELECT id FROM (SELECT DISTINCT ON (species, latitude, longitude) * FROM plantae));
